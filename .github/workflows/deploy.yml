name: æµ‹è¯•å¹¶éƒ¨ç½²ç½‘ç«™

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  # æµ‹è¯•ä»»åŠ¡
  test:
    runs-on: ubuntu-latest
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
    

    
    - name: ğŸ§ª HTMLè¯­æ³•æ£€æŸ¥
      run: |
        echo "æ£€æŸ¥HTMLåŸºæœ¬è¯­æ³•..."
        # æ£€æŸ¥HTMLæ ‡ç­¾æ˜¯å¦é…å¯¹
        if grep -q "<html>" index.html && grep -q "</html>" index.html; then
          echo "âœ… HTMLæ ‡ç­¾æ£€æŸ¥é€šè¿‡"
        else
          echo "âŒ HTMLæ ‡ç­¾ä¸å®Œæ•´"
          exit 1
        fi
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æ ‡é¢˜
        if grep -q "<title>" index.html; then
          echo "âœ… é¡µé¢æ ‡é¢˜å­˜åœ¨"
        else
          echo "âŒ ç¼ºå°‘é¡µé¢æ ‡é¢˜"
          exit 1
        fi
    
    - name: ğŸ“Š ä»£ç ç»Ÿè®¡
      run: |
        echo "ğŸ“ˆ ä»£ç ç»Ÿè®¡ä¿¡æ¯ï¼š"
        echo "HTMLæ–‡ä»¶è¡Œæ•°: $(wc -l < index.html)"
        echo "CSSæ–‡ä»¶è¡Œæ•°: $(wc -l < style.css)" 
        echo "JSæ–‡ä»¶è¡Œæ•°: $(wc -l < script.js)"
    
    - name: ğŸ¯ è¿è¡Œè‡ªå®šä¹‰æµ‹è¯•
      run: |
        if [ -f "tests/test.js" ]; then
          echo "è¿è¡Œè‡ªå®šä¹‰æµ‹è¯•..."
          node tests/test.js
        else
          echo "æ²¡æœ‰æ‰¾åˆ°è‡ªå®šä¹‰æµ‹è¯•ï¼Œè·³è¿‡"
        fi

  # éƒ¨ç½²ä»»åŠ¡ï¼ˆåªæœ‰æµ‹è¯•é€šè¿‡æ‰æ‰§è¡Œï¼‰
  deploy:
    needs: test  # å…³é”®ï¼šåªæœ‰testä»»åŠ¡æˆåŠŸæ‰è¿è¡Œdeploy
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: é…ç½®GitHub Pages
      uses: actions/configure-pages@v5
      
    - name: ä¸Šä¼ æ–‡ä»¶
      uses: actions/upload-pages-artifact@v3
      with:
        path: ./
        
    - name: ğŸš€ éƒ¨ç½²åˆ°GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
      
    - name: ğŸ‰ éƒ¨ç½²æˆåŠŸé€šçŸ¥
      run: |
        echo "âœ… ç½‘ç«™éƒ¨ç½²æˆåŠŸï¼"
        echo "ğŸŒ è®¿é—®åœ°å€: ${{ steps.deployment.outputs.page_url }}"
